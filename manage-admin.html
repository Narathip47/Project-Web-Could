<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
</head>

<body>

<div class="layout">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">‡∏à‡∏≠‡∏á</div>
        <a href="/dashboard.html">Dashboard</a>
        <a href="/manage-student.html">Manage Students</a>
        <a href="/manage-admin.html">Manage Admin</a>
        <a href="/manage-contact.html">Manage Contact</a>
        <a href="/admin.html">Logout</a>
    </div>
    <div class="main">
        <div class="admin-header">
            <h2>List of administrators</h2>

            <div class="header-controls">
                <div class="search-box">
                    <input id="searchAdmin" placeholder="Search Admin Name..." oninput="filterAdmins()" />
                    <button onclick="filterAdmins()">üîç</button>
                </div>
                <button class="create-btn" onclick="toggleCreate()">Create Admin +</button>
            </div>
        </div>

        <!-- Modal for creating admin -->
        <div id="createModal" class="modal-overlay" style="display:none;">
            <div class="modal">
                <button class="modal-close" onclick="toggleCreate()">√ó</button>
                <h3 style="margin-bottom:8px">Create Administrator</h3>
                <p style="color:#666; margin-top:0; margin-bottom:12px; font-size:14px">Fill in the details to create a new admin account.</p>

                <form id="addAdminForm" onsubmit="addAdmin(event)" class="modal-form">
                    <label class="field">
                        <span>Username</span>
                        <input type="text" id="newUsername" placeholder="Enter username" required />
                    </label>
                    <label class="field">
                        <span>Email</span>
                        <input type="email" id="newEmail" placeholder="admin@example.com" required />
                    </label>
                    <label class="field">
                        <span>Password</span>
                        <input type="password" id="newPassword" placeholder="Password" required />
                    </label>

                    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px;">
                        <button type="button" class="btn-cancel" onclick="toggleCreate()">Cancel</button>
                        <button type="submit" class="create-btn">Create</button>
                    </div>
                </form>
            </div>
        </div>

        <table class="admin-list" id="adminTable">
            <tr>
                <th>No.</th>
                <th>Username</th>
                <th>email</th>
                <th>password</th>
                <th>edit</th>
                <th>delete</th>
            </tr>
        </table>
    </div>
</div>

<script>
async function loadAdmins() {
    const res = await fetch('/api/getAdmins');
    const data = await res.json();

    if (!data.success) return;

    const table = document.getElementById('adminTable');

    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    table.innerHTML = `
        <tr>
            <th>No.</th>
            <th>Username</th>
            <th>Email</th>
            <th>Password</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
    `;

    data.admins.forEach((admin, index) => {

        table.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td style="text-align:left; padding-left:18px">${admin.username}</td>
                <td style="text-align:left">${admin.email}</td>
                <td><button class="btn-pass">üîí</button></td>
                <td>
                    <button class="btn-edit" onclick="editAdmin(${admin.id}, '${admin.username}', '${admin.email}', '${admin.password}')">‚úèÔ∏è</button>
                </td>
                <td>
                    <button class="btn-delete" onclick="deleteAdmin(${admin.id})">üóëÔ∏è</button>
                </td>
            </tr>
        `;
    });
}


async function deleteAdmin(id) {

    if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏°?")) return;

    const res = await fetch('/api/deleteAdmin/' + id, {
        method: 'DELETE'
    });

    const data = await res.json();

    if (data.success) {
        alert("‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        loadAdmins();
    }
}


async function editAdmin(id, username, email, password) {

    const newUsername = prompt("‡πÅ‡∏Å‡πâ Username:", username);
    if (!newUsername) return;

    const newEmail = prompt("‡πÅ‡∏Å‡πâ Email:", email);
    if (!newEmail) return;

    const newPassword = prompt("‡πÅ‡∏Å‡πâ Password:", password);
    if (!newPassword) return;

    const res = await fetch('/api/updateAdmin/' + id, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            username: newUsername,
            email: newEmail,
            password: newPassword
        })
    });

    const data = await res.json();

    if (data.success) {
        alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        loadAdmins();
    }
}


async function addAdmin(e) {
    e.preventDefault();

    const username = document.getElementById('newUsername').value.trim();
    const email = document.getElementById('newEmail').value.trim();
    const password = document.getElementById('newPassword').value.trim();

    if (!username || !email || !password) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
        return;
    }

    const res = await fetch('/api/addAdmin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
    });

    const data = await res.json();

    if (data.success) {
        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        document.getElementById('addAdminForm').reset();
        loadAdmins();
    } else {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ'));
    }
}

loadAdmins();

function toggleCreate(){
    const modal = document.getElementById('createModal');
    modal.style.display = modal.style.display === 'none' ? 'flex' : 'none';
}

function filterAdmins(){
    const q = document.getElementById('searchAdmin').value.toLowerCase();
    const rows = Array.from(document.querySelectorAll('#adminTable tr'));
    // skip header row (index 0)
    rows.slice(1).forEach(r => {
        const name = (r.children[1]?.innerText || '').toLowerCase();
        r.style.display = name.includes(q) ? '' : 'none';
    });
}
</script>
</body>
</html>